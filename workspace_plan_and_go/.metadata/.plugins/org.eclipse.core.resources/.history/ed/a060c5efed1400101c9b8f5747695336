<%@page import="java.util.Calendar"%>
<%@page import="java.util.ArrayList"%>
<%@page import="java.text.SimpleDateFormat"%>
<%@page import="java.util.Date"%>
<%@ page language="java" contentType="text/html; charset=UTF-8"
	pageEncoding="UTF-8" isELIgnored="false"%>

<%@ taglib prefix="fmt" uri="http://java.sun.com/jsp/jstl/fmt"%>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core"%>
<%@ taglib prefix="fn" uri="http://java.sun.com/jsp/jstl/functions"%>
<c:set var="contextPath" value="${pageContext.request.contextPath}" />
<c:set var="loggedInUser" value="${sessionScope.member}" />
<!-- ë¡œê·¸ì¸í•œ ì‚¬ìš©ì ì •ë³´ í™•ì¸ -->
<%
	request.setCharacterEncoding("UTF-8");
String SCHEDULE_ID = request.getParameter("SCHEDULE_ID");
String group_id = request.getParameter("group_id");
%>
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>ì—¬í–‰ ì¼ì • í”Œë˜ë„ˆ</title>
<link rel="stylesheet" type="text/css"
	href="${contextPath}/resources/css/style.css">
<link rel="stylesheet"
	href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css">
<script
	src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
</head>

<body id="planForm2" style="background-image: url('${contextPath}/resources/image/plan.jpeg'); background-size: cover; background-position: center;">
	<nav class="navbar navbar-expand-lg navbar-light">
		<a class="navbar-brand" href="${contextPath}/board/main.do"> 
		<img src="${contextPath}/resources/image/plan_and_go_logo.jpg" alt="Plan&Go ë¡œê³ " class="logo">
		</a> 
		<div class="ml-auto">
			<a class="btn btn-outline-primary"
						href="${contextPath}/member/logout.do">ë¡œê·¸ì•„ì›ƒ</a>
			<!-- ë¡œê·¸ì•„ì›ƒ ë§í¬ -->
			<a class="btn btn-outline-secondary"
			href="${contextPath}/review/list.do">ë¦¬ë·° ê²Œì‹œíŒ</a>
						
			<a class="btn btn-outline-success" href="#" onclick="postToMyPage(); return false;">ë§ˆì´í˜ì´ì§€</a>
			<!-- myPage POST ìš”ì²­ìœ¼ë¡œ ìˆ˜ì • -->
			<form id="planFormMyPage" action="${contextPath}/board/myPage.do" method="POST">
				<input type="hidden" name="MEMBER_ID" value="${loggedInUser.MEMBER_ID}">
			</form>
		</div>
	</nav>
	
	<div class="container mt-5">
		<h1>ì—¬í–‰ ì¼ì • í”Œë˜ë„ˆ</h1>
		<form
			action="${contextPath}/planner/clearSession.do?MEMBER_ID=${loggedInUser.MEMBER_ID}"
			method="POST">
			<!-- ë„ì‹œ ì„ íƒ -->
			<div class="mb-3">
				<label for="region" class="form-label">ì—¬í–‰ ë„ì‹œ ì„ íƒ</label> <select
					id="region" name="region" class="form-select" required>
					<option value="${region}">${region}</option>
				</select>
			</div>

			<!-- ë‚ ì§œ ëª©ë¡ -->
			<div class="list-group mt-4">
				<c:forEach items="${dateList}" var="dl">
					<button type="button"
						class="list-group-item list-group-item-action"
						data-bs-toggle="modal" data-bs-target="#scheduleModal"
						onclick="openScheduleModal('${dl}')">${dl}</button>
				</c:forEach>
			</div>

			<!-- ì¼ì • ìƒì„± ë²„íŠ¼ -->

		</form>

		<!-- ë‚ ì§œ ì„ íƒ ë“œë¡­ë‹¤ìš´ -->
<div class="date-filter-container">
    <label class="date-label" for="filterDate">ë‚ ì§œ ì„ íƒ</label>
    <select id="filterDate" class="form-select date-select" onchange="filterSchedule()">
        <option value="">ì „ì²´ ë³´ê¸°</option>
        <c:set var="uniqueDates" value="" />
        <c:forEach var="activityFilter" items="${activityList}">
            <c:set var="formattedDate">
                <fmt:formatDate value='${activityFilter.ACTIVITY_DATE}' pattern='yyyy-MM-dd' />
            </c:set>
            <c:if test="${not fn:contains(uniqueDates, formattedDate)}">
                <option value="${formattedDate}">${formattedDate}</option>
                <c:set var="uniqueDates" value="${uniqueDates},${formattedDate}" />
            </c:if>
        </c:forEach>
    </select>
</div>



		<!-- ì €ì¥ëœ ì¼ì • ëª©ë¡ -->
		<div class="schedule-container">
			<h3 class="mt-4">ì €ì¥ëœ ì¼ì •</h3>
			<form id="planFormMyPage2" action="${contextPath}/board/myPage.do" method="POST">
				<input type="hidden" name="MEMBER_ID" value="${loggedInUser.MEMBER_ID}">
			</form>
			<%-- <a href="${contextPath}/board/myPage.do?MEMBER_ID=${loggedInUser.MEMBER_ID}" class="mypage-btn">ë§ˆì´í˜ì´ì§€</a> --%>
		</div>
		<div id="scheduleList"></div>
		<table border="1" align="center" width="80%" id="scheduleTable">
			<thead>
				<tr align="center">
					<td><b>ë‚ ì§œ</b></td>
					<td><b>ì‹œê°„</b></td>
					<td><b>ì¼ì • ì œëª©</b></td>
					<td><b>ë°©ë¬¸ ì¥ì†Œ</b></td>
					<td><b>ì˜ˆìƒ ë¹„ìš©</b></td>
					<td><b>ì‹¤ì œ ë¹„ìš©</b></td>
					<td><b>ë¹„ê³ </b></td>
					<td><b>ìˆ˜ì •</b></td>
					<td><b>ì‚­ì œ</b></td>
				</tr>
			</thead>
			<tbody>
				<c:forEach var="activity" items="${activityList}">
					<tr align="center"
						data-date="<fmt:formatDate value='${activity.ACTIVITY_DATE}' pattern='yyyy-MM-dd' />">
						<td><fmt:formatDate value="${activity.ACTIVITY_DATE}"
								pattern="yyyy-MM-dd" /></td>
						<td>${activity.ACTIVITY_TIME}</td>
						<td>${activity.ACTIVITY_NAME}</td>
						<td>${activity.PLACE_NAME}</td>
						<td>${activity.EXPECTED_COST}</td>
						<td>${activity.ACTUAL_COST}</td>
						<td>${activity.COMMENT}</td>
						<td><button type="button" class="btn btn-primary"
								data-bs-toggle="modal" data-bs-target="#scheduleUpdateModal"
								onclick="openUpdateScheduleModal('<fmt:formatDate value="${activity.ACTIVITY_DATE}" pattern="yyyy-MM-dd" />', 
		                        '${activity.ACTIVITY_TIME}', '${activity.ACTIVITY_NAME}', 
		                        '${activity.PLACE_NAME}', '${activity.EXPECTED_COST}', 
		                        '${activity.ACTUAL_COST}', '${activity.ACTIVITY_ID}',
		                        '${activity.COMMENT}')">ìˆ˜ì •í•˜ê¸°</button>
						</td>
						<td>
							<form action="${contextPath}/planner/removeActivity.do"
								method="post" onsubmit="return confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?');">
								<input type="hidden" name="region" value="${region}">
								<input type="hidden" name="start_date" value="${start_date}">
								<input type="hidden" name="end_date" value="${end_date}">
								<input type="hidden" name="group_id" value="${group_id}">
								<input type="hidden" name="schedule_id" value="${schedule_id}">
								<input type="hidden" name="ACTIVITY_ID"
									value="${activity.ACTIVITY_ID}">
								<button type="submit" class="btn btn-danger">ì‚­ì œí•˜ê¸°</button>
							</form>
						</td>
					</tr>
				</c:forEach>
			</tbody>
		</table>


	</div>

	<!-- ì¼ì • ëª¨ë‹¬ -->
	<div class="modal fade" id="scheduleModal" tabindex="-1"
		aria-labelledby="scheduleModalLabel" aria-hidden="true">
		<div class="modal-dialog modal-lg">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title" id="scheduleModalLabel">ì¼ì • ì…ë ¥</h5>
					<button type="button" class="btn-close" data-bs-dismiss="modal"
						aria-label="Close"></button>
				</div>
				<div class="modal-body">
					<form action="${contextPath}/planner/saveActivity.do" method="POST">
						<input type="hidden" id="region" name="region" value="${region}" />
						<input type="hidden" name="SCHEDULE_ID" value="${schedule_id}" />
						<input type="hidden" name="group_id" value="${group_id}" /> <input
							type="hidden" name="start_date" value="${start_date}" /> <input
							type="hidden" name="end_date" value="${end_date}" />

						<!-- ì„ íƒëœ ë‚ ì§œ -->
						<div class="mb-3">
							<label for="ACTIVITY_DATE" class="form-label">ì„ íƒëœ ë‚ ì§œ</label> <input
								type="text" id="ACTIVITY_DATE" name="ACTIVITY_DATE"
								class="form-control" readonly>
						</div>

						<!-- ì„ íƒëœ ì‹œê°„ -->
						<div class="mb-3">
							<label for="scheduleTime" class="form-label">ì‹œê°„</label> <input
								type="time" id="ACTIVITY_TIME" name="ACTIVITY_TIME"
								class="form-control" required>
						</div>

						<!-- ì¼ì • ì œëª© -->
						<div class="mb-3">
							<label for="scheduleTitle" class="form-label">ì¼ì • ì œëª©</label> <input
								type="text" id="ACTIVITY_NAME" name="ACTIVITY_NAME"
								class="form-control" required>
						</div>

						<!-- ë°©ë¬¸ ì¥ì†Œ ì„ íƒ -->
						<div class="mb-3">
							<label for="schedulePlace" class="form-label">ë°©ë¬¸ ì¥ì†Œ ì„ íƒ</label>
							<div class="d-flex">
								<input type="text" id="PLACE_NAME" name="PLACE_NAME"
									class="form-control" placeholder="ì„ íƒëœ ì¥ì†Œ" readonly required>
								<button type="button" class="btn btn-secondary ms-2"
									data-bs-toggle="modal" data-bs-target="#placeListModal">ì¥ì†Œ
									ì„ íƒ</button>
							</div>
						</div>

						<!-- ì˜ˆìƒ ë¹„ìš© -->
						<div class="mb-3">
							<label for="estimatedCost" class="form-label">ì˜ˆìƒ ë¹„ìš©</label> <input
								type="number" id="EXPECTED_COST" name="EXPECTED_COST"
								class="form-control" placeholder="ì˜ˆìƒ ë¹„ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”" required>
						</div>

						<!-- ì‹¤ì œ ë¹„ìš© -->
						<div class="mb-3">
							<label for="actualCost" class="form-label">ì‹¤ì œ ë¹„ìš©</label> <input
								type="number" id="ACTUAL_COST" name="ACTUAL_COST"
								class="form-control" placeholder="ì‹¤ì œ ë¹„ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”">
						</div>

						<!-- ë¹„ê³  -->
						<div class="mb-3">
							<label for="comment" class="form-label">ë¹„ê³ </label>
							<textarea id="COMMENT" name="COMMENT" class="form-control"
								placeholder="50ì ê¹Œì§€ ì…ë ¥ ê°€ëŠ¥í•©ë‹ˆë‹¤." rows="4" maxlength="50"></textarea>
						</div>

						<button type="submit" class="btn btn-primary">ì¼ì • ì €ì¥</button>
					</form>
				</div>
			</div>
		</div>
	</div>

	<!-- ì¼ì • ìˆ˜ì • ëª¨ë‹¬ -->
	<div class="modal fade" id="scheduleUpdateModal" tabindex="-1"
		aria-labelledby="scheduleUpdateModalLabel" aria-hidden="true">
		<div class="modal-dialog modal-lg">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title" id="scheduleUpdateModalLabel">ì¼ì • ìˆ˜ì •</h5>
					<button type="button" class="btn-close" data-bs-dismiss="modal"
						aria-label="Close"></button>
				</div>
				<div class="modal-body">
					<form action="${contextPath}/planner/updateActivity.do"
						method="POST">
						<input type="hidden" id="region" name="region" value="${region}" />
						<input type="hidden" name="SCHEDULE_ID" value="${schedule_id}" />
						<input type="hidden" name="group_id" value="${group_id}" /> <input
							type="hidden" name="start_date" value="${start_date}" /> <input
							type="hidden" name="end_date" value="${end_date}" /> <input
							type="hidden" id="ACTIVITY_ID" name="ACTIVITY_ID" />

						<!-- ì„ íƒëœ ë‚ ì§œ -->
						<div class="mb-3">
							<label for="ACTIVITY_DATE" class="form-label">ì„ íƒëœ ë‚ ì§œ:</label> <input
								type="text" id="UPDATE_ACTIVITY_DATE"
								name="UPDATE_ACTIVITY_DATE" class="form-control"
								placeholder="YYYY-MM-DD" required>
						</div>

						<!-- ì„ íƒëœ ì‹œê°„ -->
						<div class="mb-3">
							<label for="scheduleTime" class="form-label">ì‹œê°„:</label> <input
								type="time" id="UPDATE_ACTIVITY_TIME"
								name="UPDATE_ACTIVITY_TIME" class="form-control" required>
						</div>

						<!-- ì¼ì • ì œëª© -->
						<div class="mb-3">
							<label for="scheduleTitle" class="form-label">ì¼ì • ì œëª©:</label> <input
								type="text" id="UPDATE_ACTIVITY_NAME"
								name="UPDATE_ACTIVITY_NAME" class="form-control" required>
						</div>

						<!-- ë°©ë¬¸ ì¥ì†Œ ì„ íƒ -->
						<div class="mb-3">
							<label for="schedulePlace" class="form-label">ë°©ë¬¸ ì¥ì†Œ ì„ íƒ:</label>
							<div class="d-flex">
								<input type="text" id="UPDATE_PLACE_NAME"
									name="UPDATE_PLACE_NAME" class="form-control"
									placeholder="ì„ íƒëœ ì¥ì†Œ" readonly required>
								<button type="button" class="btn btn-secondary ms-2"
									data-bs-toggle="modal" data-bs-target="#UpdatePlaceListModal">ì¥ì†Œ
									ì„ íƒ</button>
							</div>
						</div>

						<!-- ì˜ˆìƒ ë¹„ìš© -->
						<div class="mb-3">
							<label for="estimatedCost" class="form-label">ì˜ˆìƒ ë¹„ìš©:</label> <input
								type="number" id="UPDATE_EXPECTED_COST"
								name="UPDATE_EXPECTED_COST" class="form-control"
								placeholder="ì˜ˆìƒ ë¹„ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”" required>
						</div>

						<!-- ì‹¤ì œ ë¹„ìš© -->
						<div class="mb-3">
							<label for="actualCost" class="form-label">ì‹¤ì œ ë¹„ìš©:</label> <input
								type="number" id="UPDATE_ACTUAL_COST" name="UPDATE_ACTUAL_COST"
								class="form-control" placeholder="ì‹¤ì œ ë¹„ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”">
						</div>

						<!-- ë¹„ê³  -->
						<div class="mb-3">
							<label for="comment" class="form-label">ë¹„ê³ :</label>
							<textarea id="UPDATE_COMMENT" name="UPDATE_COMMENT"
								class="form-control" placeholder="50ì ê¹Œì§€ ì…ë ¥ ê°€ëŠ¥í•©ë‹ˆë‹¤." rows="4"
								maxlength="50"></textarea>
						</div>

						<button type="submit" class="btn btn-primary">ì¼ì • ìˆ˜ì •</button>
					</form>
				</div>
			</div>
		</div>
	</div>

	<!-- ì¥ì†Œ ë¦¬ìŠ¤íŠ¸ ëª¨ë‹¬ -->
	<div class="modal fade" id="placeListModal" tabindex="-1"
		aria-labelledby="placeListModalLabel" aria-hidden="true">
		<div class="modal-dialog modal-lg">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title" id="placeListModalLabel">ì¥ì†Œ ë¦¬ìŠ¤íŠ¸</h5>
					<button type="button" class="btn-close" data-bs-dismiss="modal"
						aria-label="Close"></button>
				</div>
				<div class="modal-body">
					<!-- ğŸ”¹ ê²€ìƒ‰ ì…ë ¥ì°½ ì¶”ê°€ -->
					<input type="text" id="placeSearchInput" class="form-control mb-3"
						placeholder="ì¥ì†Œ ê²€ìƒ‰..." onkeyup="filterPlaces()">

					<!-- ì¹´í…Œê³ ë¦¬ ë²„íŠ¼ -->
					<div class="mb-3">
						<button class="btn btn-primary category-btn" data-category="all"
							data-modal="list">ì „ì²´</button>
						<button class="btn btn-secondary category-btn" data-category="ì‹ë‹¹"
							data-modal="list">ì‹ë‹¹</button>
						<button class="btn btn-success category-btn" data-category="ê´€ê´‘ì§€"
							data-modal="list">ê´€ê´‘ì§€</button>
						<button class="btn btn-warning category-btn" data-category="ìˆ™ì†Œ"
							data-modal="list">ìˆ™ì†Œ</button>
					</div>

					<!-- ì¥ì†Œ ë¦¬ìŠ¤íŠ¸ -->
					<div class="row" id="placeContainer">
					
						<c:forEach items="${place}" var="placeList">
							<div class="mb-3 place-item"
								data-category="${placeList.category}">
								<img
									src="${contextPath}/resources/plan_and_go_image/place_image/${placeList.image}.jpg"
									alt="${placeList.name}" class="img-fluid"
									style="cursor: pointer;"
									onclick="showPlaceDetails('${placeList.name}', '${placeList.image}', '${placeList.info}')">
								<h6>${placeList.name}</h6>
							</div>
						</c:forEach>
					</div>
				</div>
			</div>
		</div>
	</div>

	<!-- ì¥ì†Œ ìˆ˜ì • ëª¨ë‹¬ -->
	<div class="modal fade" id="UpdatePlaceListModal" tabindex="-1"
		aria-labelledby="UpdatePlaceListModalLabel" aria-hidden="true">
		<div class="modal-dialog modal-lg">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title" id="UpdatePlaceListModalLabel">ì¥ì†Œ ë¦¬ìŠ¤íŠ¸</h5>
					<button type="button" class="btn-close" data-bs-dismiss="modal"
						aria-label="Close"></button>
				</div>
				<div class="modal-body">
					<!-- ğŸ”¹ ê²€ìƒ‰ ì…ë ¥ì°½ ì¶”ê°€ -->
					<input type="text" id="UpdatePlaceSearchInput"
						class="form-control mb-3" placeholder="ì¥ì†Œ ê²€ìƒ‰..."
						onkeyup="UpdateFilterPlaces()">

					<!-- ì¹´í…Œê³ ë¦¬ ë²„íŠ¼ -->
					<div class="mb-3">
						<button class="btn btn-primary category-btn" data-category="all"
							data-modal="update">ì „ì²´</button>
						<button class="btn btn-secondary category-btn" data-category="ì‹ë‹¹"
							data-modal="update">ì‹ë‹¹</button>
						<button class="btn btn-success category-btn" data-category="ê´€ê´‘ì§€"
							data-modal="update">ê´€ê´‘ì§€</button>
						<button class="btn btn-warning category-btn" data-category="ìˆ™ì†Œ"
							data-modal="update">ìˆ™ì†Œ</button>
					</div>

					<!-- ì¥ì†Œ ë¦¬ìŠ¤íŠ¸ -->
					<div class="row" id="updatePlaceContainer">
						<c:forEach items="${place}" var="UpdatePlaceList">
							<div class="mb-3 update-place-item"
								data-category="${UpdatePlaceList.category}">
								<img
									src="${contextPath}/resources/plan_and_go_image/place_image/${UpdatePlaceList.image}.jpg"
									alt="${UpdatePlaceList.name}" class="img-fluid"
									style="cursor: pointer;"
									onclick="UpdateShowPlaceDetails('${UpdatePlaceList.name}', '${UpdatePlaceList.image}', '${UpdatePlaceList.info}')">
								<h6>${UpdatePlaceList.name}</h6>
							</div>
						</c:forEach>
					</div>
				</div>
			</div>
		</div>
	</div>

	<!-- ì¥ì†Œ ìƒì„¸ ì •ë³´ ëª¨ë‹¬ -->
	<div class="modal fade" id="placeModal" tabindex="-1"
		aria-labelledby="placeModalLabel" aria-hidden="true">
		<div class="modal-dialog modal-lg">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title" id="placeModalLabel">ì¥ì†Œ ìƒì„¸ ì •ë³´</h5>
					<button type="button" class="btn-close" data-bs-dismiss="modal"
						aria-label="Close"></button>
				</div>
				<div class="modal-body">
					<!-- ì¥ì†Œ ìƒì„¸ ë‚´ìš© -->
					<img id="detailImage" src="" alt="" class="img-fluid mb-3">
					<h5 id="detailName"></h5>
					<p id="detailInfo"></p>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-primary"
						onclick="selectPlace()">ì„ íƒí•˜ê¸°</button>
					<button type="button" class="btn btn-secondary"
						data-bs-dismiss="modal">ë‹«ê¸°</button>
				</div>
			</div>
		</div>
	</div>

	<!-- ì¥ì†Œ ìˆ˜ì • ìƒì„¸ ì •ë³´ ëª¨ë‹¬ -->
	<div class="modal fade" id="UpdatePlaceModal" tabindex="-1"
		aria-labelledby="UpdatePlaceModalLabel" aria-hidden="true">
		<div class="modal-dialog modal-lg">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title" id="UpdatePlaceModalLabel">ì¥ì†Œ ìƒì„¸ ì •ë³´</h5>
					<button type="button" class="btn-close" data-bs-dismiss="modal"
						aria-label="Close"></button>
				</div>
				<div class="modal-body">
					<!-- ì¥ì†Œ ìƒì„¸ ë‚´ìš© -->
					<img id="updateDetailImage" src="" alt="" class="img-fluid mb-3">
					<h5 id="updateDetailName"></h5>
					<p id="updateDetailInfo"></p>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-primary"
						onclick="selectUpdatePlace()">ì„ íƒí•˜ê¸°</button>
					<button type="button" class="btn btn-secondary"
						data-bs-dismiss="modal">ë‹«ê¸°</button>
				</div>
			</div>
		</div>
	</div>

	<script>
		let selectedPlaceName = '';
		let selectedDate = ""; // ì„ íƒëœ ë‚ ì§œ ì €ì¥ ë³€ìˆ˜
		let datePlaceMap = {}; // ë‚ ì§œë³„ë¡œ ì„ íƒëœ ì¥ì†Œë¥¼ ì €ì¥í•  ê°ì²´
		let scheduleList = []; // ì €ì¥ëœ ì¼ì • ëª©ë¡

		const urlParams = new URLSearchParams(window.location.search);
		if (urlParams.get("error") === "true") {
			alert("ì¼ì • ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
		}
		
		document.addEventListener("DOMContentLoaded", function () {
		    let selectedCategoryList = "all"; // ì¥ì†Œ ë¦¬ìŠ¤íŠ¸ ëª¨ë‹¬ ê¸°ë³¸ ì¹´í…Œê³ ë¦¬
		    let selectedCategoryUpdate = "all"; // ì¥ì†Œ ìˆ˜ì • ëª¨ë‹¬ ê¸°ë³¸ ì¹´í…Œê³ ë¦¬

		    // ì¹´í…Œê³ ë¦¬ ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸ ì¶”ê°€
		    document.querySelectorAll(".category-btn").forEach(button => {
		        button.addEventListener("click", function () {
		            let category = this.getAttribute("data-category");
		            let modalType = this.getAttribute("data-modal");

		            if (modalType === "list") {
		                selectedCategoryList = category; // ì„ íƒëœ ì¹´í…Œê³ ë¦¬ ì €ì¥
		                filterPlaces(selectedCategoryList);
		            } else if (modalType === "update") {
		                selectedCategoryUpdate = category; // ì„ íƒëœ ì¹´í…Œê³ ë¦¬ ì €ì¥
		                UpdateFilterPlaces(selectedCategoryUpdate);
		            }
		        });
		    });

		    // ì¥ì†Œ ë¦¬ìŠ¤íŠ¸ ëª¨ë‹¬ ê²€ìƒ‰ ì´ë²¤íŠ¸
		    document.getElementById("placeSearchInput").addEventListener("keyup", function () {
		        filterPlaces(selectedCategoryList);
		    });

		    // ì¥ì†Œ ìˆ˜ì • ëª¨ë‹¬ ê²€ìƒ‰ ì´ë²¤íŠ¸
		    document.getElementById("UpdatePlaceSearchInput").addEventListener("keyup", function () {
		        UpdateFilterPlaces(selectedCategoryUpdate);
		    });
		});
		
		function filterSchedule() {
		    var selectedDate = document.getElementById("filterDate").value;
		    var rows = document.querySelectorAll("#scheduleTable tbody tr"); // ì¼ì • ëª©ë¡ì˜ ê° í–‰ ê°€ì ¸ì˜¤ê¸°

		    rows.forEach(function(row) {
		        var activityDate = row.getAttribute("data-date"); // ê° í–‰ì˜ ë‚ ì§œ ê°’ ê°€ì ¸ì˜¤ê¸°
		        if (selectedDate === "" || activityDate === selectedDate) {
		            row.style.display = ""; // ì„ íƒí•œ ë‚ ì§œì™€ ê°™ê±°ë‚˜ ì „ì²´ ë³´ê¸°ë©´ í‘œì‹œ
		        } else {
		            row.style.display = "none"; // ì„ íƒí•œ ë‚ ì§œì™€ ë‹¤ë¥´ë©´ ìˆ¨ê¹€
		        }
		    });
		}
		
		// ë‚ ì§œ ë²„íŠ¼ í´ë¦­ ì‹œ ëª¨ë‹¬ì— ë‚ ì§œ ì „ë‹¬
		function openScheduleModal(date) {

			selectedDate = date; // ì„ íƒí•œ ë‚ ì§œ ì €ì¥
			console.log(selectedDate);
			document.getElementById("ACTIVITY_DATE").value = selectedDate; // ëª¨ë‹¬ì˜ ë‚ ì§œ ì…ë ¥ í•„ë“œì— ë‚ ì§œ í‘œì‹œ
			// ì„ íƒëœ ë‚ ì§œì— í•´ë‹¹í•˜ëŠ” ì¥ì†Œê°€ ì´ë¯¸ ì„ íƒë˜ì–´ ìˆìœ¼ë©´, í•´ë‹¹ ì¥ì†Œë¥¼ í‘œì‹œ
			const placeName = datePlaceMap[selectedDate] || "";
			document.getElementById("PLACE_NAME").value = placeName;
		}
		
		function openUpdateScheduleModal(date, time, act_name, plc_name, exp_cost, act_cost, act_id, comment) {

			document.getElementById("UPDATE_ACTIVITY_DATE").value = date; // ëª¨ë‹¬ì˜ ë‚ ì§œ ì…ë ¥ í•„ë“œì— ë‚ ì§œ í‘œì‹œ
			document.getElementById("UPDATE_ACTIVITY_TIME").value = time;
			document.getElementById("UPDATE_ACTIVITY_NAME").value = act_name;
			document.getElementById("UPDATE_PLACE_NAME").value = plc_name;
			document.getElementById("UPDATE_EXPECTED_COST").value = exp_cost;
			document.getElementById("UPDATE_ACTUAL_COST").value = act_cost;
			document.getElementById("ACTIVITY_ID").value = act_id;
			document.getElementById("UPDATE_COMMENT").value = comment;
		}
		
		function filterPlaces(category = "all") {
		    const input = document.getElementById("placeSearchInput").value.toLowerCase();
		    let places = document.querySelectorAll("#placeContainer .place-item");

		    places.forEach(place => {
		        let placeCategory = place.getAttribute("data-category");
		        let placeName = place.querySelector("h6").textContent.toLowerCase();

		        let categoryMatch = (category === "all" || placeCategory === category);
		        let searchMatch = placeName.includes(input);

		        place.style.display = (categoryMatch && searchMatch) ? "block" : "none";
		    });
		}
		
		function UpdateFilterPlaces(category = "all") {
		    const input = document.getElementById("UpdatePlaceSearchInput").value.toLowerCase();
		    let places = document.querySelectorAll("#updatePlaceContainer .update-place-item");

		    places.forEach(place => {
		        let placeCategory = place.getAttribute("data-category");
		        let placeName = place.querySelector("h6").textContent.toLowerCase();

		        let categoryMatch = (category === "all" || placeCategory === category);
		        let searchMatch = placeName.includes(input);

		        place.style.display = (categoryMatch && searchMatch) ? "block" : "none";
		    });
		}


		// ì¥ì†Œ ìƒì„¸ ì •ë³´ ëª¨ë‹¬ì— í‘œì‹œ
		function showPlaceDetails(name, image, info) {
			let imagePath = image.startsWith("http") ? image : `${contextPath}/resources/plan_and_go_image/place_image/` + image + `.jpg`;
			document.getElementById("detailName").textContent = name;
			document.getElementById("detailImage").src = imagePath;
			document.getElementById("detailInfo").textContent = info;
			selectedPlaceName = name;

			// ì¥ì†Œ ìƒì„¸ ì •ë³´ ëª¨ë‹¬ ì—´ê¸°
			const placeModal = new bootstrap.Modal(document
					.getElementById('placeModal'));
			placeModal.show();
		}
		
		function UpdateShowPlaceDetails(name, image, info) {
			let imagePath = image.startsWith("http") ? image : `${contextPath}/resources/plan_and_go_image/place_image/` + image + `.jpg`;
			document.getElementById("updateDetailName").textContent = name;
			document.getElementById("updateDetailImage").src = imagePath;
			document.getElementById("updateDetailInfo").textContent = info;
			selectedPlaceName = name;

			// ì¥ì†Œ ìƒì„¸ ì •ë³´ ëª¨ë‹¬ ì—´ê¸°
			const placeModal = new bootstrap.Modal(document
					.getElementById('UpdatePlaceModal'));
			placeModal.show();
		}

		// ì¥ì†Œ ì„ íƒ í•¨ìˆ˜
		function selectPlace() {
			if (!selectedPlaceName) {
				alert("ì¥ì†Œë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.");
				return;
			}

			// ì„ íƒëœ ì¥ì†Œë¥¼ ì¼ì • ëª¨ë‹¬ì— ë°˜ì˜
			document.getElementById("PLACE_NAME").value = selectedPlaceName;

			// ì¥ì†Œ ë¦¬ìŠ¤íŠ¸ ëª¨ë‹¬ ë‹«ê¸°
			const placeModal = bootstrap.Modal.getInstance(document
					.getElementById('placeModal'));
			const placeListModal = bootstrap.Modal.getInstance(document
					.getElementById('placeListModal'));

			if (placeModal)
				placeModal.hide();
			if (placeListModal)
				placeListModal.hide();

			// ì¼ì • ì…ë ¥ ëª¨ë‹¬ ì—´ê¸°
			const scheduleModal = new bootstrap.Modal(document
					.getElementById('scheduleModal'));
			scheduleModal.show();
		}
		
		// ì¥ì†Œ ìˆ˜ì • í•¨ìˆ˜
		function selectUpdatePlace() {
			if (!selectedPlaceName) {
				alert("ì¥ì†Œë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.");
				return;
			}

			// ì„ íƒëœ ì¥ì†Œë¥¼ ì¼ì • ëª¨ë‹¬ì— ë°˜ì˜
			document.getElementById("UPDATE_PLACE_NAME").value = selectedPlaceName;

			// ì¥ì†Œ ë¦¬ìŠ¤íŠ¸ ëª¨ë‹¬ ë‹«ê¸°
			const placeModal = bootstrap.Modal.getInstance(document
					.getElementById('UpdatePlaceModal'));
			const placeListModal = bootstrap.Modal.getInstance(document
					.getElementById('UpdatePlaceListModal'));

			if (placeModal)
				placeModal.hide();
			if (placeListModal)
				placeListModal.hide();

			// ì¼ì • ì…ë ¥ ëª¨ë‹¬ ì—´ê¸°
			const scheduleModal = new bootstrap.Modal(document
					.getElementById('scheduleUpdateModal'));
			scheduleModal.show();
		}
	</script>

</body>
</html>
